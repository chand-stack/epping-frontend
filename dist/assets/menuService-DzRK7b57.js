import{_ as p}from"./index-VxDcpnsG.js";class k{storageKey="eppingFoodCourtMenuItems";listeners=[];inMemoryItems=null;isSaving=!1;pendingSave=!1;constructor(){this.initializeMenu(),this.autoImportFromCsvIfRequested()}initializeMenu(){if(!localStorage.getItem(this.storageKey)){const e=[{id:"ohsmash-smash-burger",restaurant:"OhSmash",category:"Burgers",name:"Smash Burger",price:9.5,description:"Double beef patty with cheese, lettuce, tomato, and our signature sauce",image:"/assets/ohsmash-burger.jpg",veg:!1,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"ohsmash-bacon-burger",restaurant:"OhSmash",category:"Burgers",name:"Bacon Smash Burger",price:11.5,description:"Smash burger with crispy bacon, cheese, and special sauce",image:"/assets/ohsmash-bacon-burger.jpg",veg:!1,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"ohsmash-fries",restaurant:"OhSmash",category:"Sides",name:"Crispy Fries",price:3.5,description:"Golden crispy fries with sea salt",image:"/assets/ohsmash-fries.jpg",veg:!0,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"wonder-wings-original",restaurant:"Wonder Wings",category:"Wings",name:"Original Wings (6pc)",price:8.5,description:"Crispy wings with our original seasoning",image:"/assets/wonder-wings-original.jpg",veg:!1,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"wonder-wings-buffalo",restaurant:"Wonder Wings",category:"Wings",name:"Buffalo Wings (6pc)",price:8.5,description:"Spicy buffalo wings with blue cheese dip",image:"/assets/wonder-wings-buffalo.jpg",veg:!1,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"wonder-wings-combo",restaurant:"Wonder Wings",category:"Combos",name:"Wings & Fries Combo",price:12.5,description:"6 wings with crispy fries and a drink",image:"/assets/wonder-wings-combo.jpg",veg:!1,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"okra-green-butter-chicken",restaurant:"Okra Green",category:"Curries",name:"Butter Chicken",price:13.5,description:"Tender chicken in rich tomato and cream sauce",image:"/assets/okra-green-butter-chicken.jpg",veg:!1,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"okra-green-dal",restaurant:"Okra Green",category:"Curries",name:"Dal Tadka",price:8.5,description:"Lentil curry with aromatic spices",image:"/assets/okra-green-dal.jpg",veg:!0,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"okra-green-naan",restaurant:"Okra Green",category:"Breads",name:"Garlic Naan",price:3.5,description:"Fresh baked naan with garlic and herbs",image:"/assets/okra-green-naan.jpg",veg:!0,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}];localStorage.setItem(this.storageKey,JSON.stringify(e))}}parseCsvLine(e){const t=[];let r="",i=!1;for(let s=0;s<e.length;s++){const o=e[s];o==='"'?i&&e[s+1]==='"'?(r+='"',s++):i=!i:o===","&&!i?(t.push(r.trim()),r=""):r+=o}return t.push(r.trim()),t}importFromCsv(e){const t=e.split(/\r?\n/).filter(n=>n.trim().length>0);if(t.length<=1)return;const r=this.parseCsvLine(t[0]).map(n=>n.toLowerCase()),i=n=>r.indexOf(n.toLowerCase()),s=i("brand"),o=i("category"),S=i("name"),f=i("description"),w=i("price"),y=i("veg"),I=i("image"),c=[],l=new Date().toISOString();for(let n=1;n<t.length;n++){const a=this.parseCsvLine(t[n]);if(!a.length)continue;const g=(a[s]||"").trim(),u=(a[S]||"").trim(),m=(a[w]||"").trim();if(!g||!u||!m)continue;const h=Number(m);if(Number.isNaN(h))continue;const O=(a[o]||"General").trim(),v=(a[f]||"").trim(),D=(a[I]||"").trim(),d=(a[y]||"").trim().toLowerCase(),A=d==="true"||d==="yes"||d==="1",b=`${g.toLowerCase().replace(/\s+/g,"-")}-${u.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;c.push({id:b,restaurant:g,category:O,name:u,price:h,description:v,image:D,veg:A,inStock:!0,createdAt:l,updatedAt:l})}c.length>0&&(this.reset(c),localStorage.setItem("eppingMenuImportedFromCsv","true"))}async autoImportFromCsvIfRequested(){try{if(localStorage.getItem("eppingMenuImportedFromSite")==="true")return;const{siteMenus:t}=await p(async()=>{const{siteMenus:r}=await import("./siteMenus-CuqaLtRx.js");return{siteMenus:r}},[]);this.importFromSiteMenus(t),localStorage.setItem("eppingMenuImportedFromSite","true")}catch(e){console.error("Failed to auto-import menu:",e)}}loadFromStorage(){const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}saveToStorageDebounced(){if(this.isSaving){this.pendingSave=!0;return}this.isSaving=!0;try{this.inMemoryItems&&localStorage.setItem(this.storageKey,JSON.stringify(this.inMemoryItems))}finally{this.isSaving=!1,this.pendingSave&&(this.pendingSave=!1,setTimeout(()=>this.saveToStorageDebounced(),0))}}getAll(){return this.inMemoryItems||(this.inMemoryItems=this.loadFromStorage()),this.inMemoryItems}getByRestaurant(e){return this.getAll().filter(t=>t.restaurant===e)}getById(e){return this.getAll().find(t=>t.id===e)||null}add(e){const t=this.getAll(),r={...e,id:`${e.restaurant.toLowerCase().replace(/\s+/g,"-")}-${e.name.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.unshift(r),this.inMemoryItems=t,this.saveToStorageDebounced(),this.notify(),r}update(e,t){const r=this.getAll(),i=r.findIndex(s=>s.id===e);return i===-1?null:(r[i]={...r[i],...t,updatedAt:new Date().toISOString()},this.inMemoryItems=r,this.saveToStorageDebounced(),this.notify(),r[i])}remove(e){const t=this.getAll(),r=t.filter(i=>i.id!==e);return r.length===t.length?!1:(this.inMemoryItems=r,this.saveToStorageDebounced(),this.notify(),!0)}setStock(e,t){if(!this.getById(e))return!1;const i=this.update(e,{inStock:t})!==null;return this.notify(),i}search(e){const t=this.getAll(),r=e.toLowerCase();return t.filter(i=>i.name.toLowerCase().includes(r)||i.description.toLowerCase().includes(r)||i.category.toLowerCase().includes(r))}getCategories(e){const t=e?this.getByRestaurant(e):this.getAll(),r=new Set(t.map(i=>i.category));return Array.from(r).sort()}getStats(){const e=this.getAll();return{total:e.length,inStock:e.filter(t=>t.inStock).length,outOfStock:e.filter(t=>!t.inStock).length,byRestaurant:{OhSmash:e.filter(t=>t.restaurant==="OhSmash").length,"Wonder Wings":e.filter(t=>t.restaurant==="Wonder Wings").length,"Okra Green":e.filter(t=>t.restaurant==="Okra Green").length},byCategory:e.reduce((t,r)=>(t[r.category]=(t[r.category]||0)+1,t),{})}}reset(e=[]){this.inMemoryItems=e,this.saveToStorageDebounced(),this.notify()}async forceImportFromSite(){try{const{siteMenus:e}=await p(async()=>{const{siteMenus:t}=await import("./siteMenus-CuqaLtRx.js");return{siteMenus:t}},[]);this.importFromSiteMenus(e),localStorage.setItem("eppingMenuImportedFromSite","true")}catch(e){throw console.error("Failed to force import menu:",e),e}}importFromSiteMenus(e){const t=[];Object.entries(e).forEach(([r,i])=>{i.forEach(s=>{t.push({id:`${r.toLowerCase().replace(/\s+/g,"-")}-${s.name.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,restaurant:r,category:s.category||"General",name:s.name,price:s.price,description:s.description||"",image:s.image||"",veg:!!s.veg,inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})})}),this.reset(t)}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notify(){this.listeners.forEach(e=>{try{e()}catch{}})}}const F=new k;export{F as m};
